<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>順位入力アプリ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }
        .container {
            border: 1px solid #e0e0e0;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: auto;
        }
        .image-container {
            text-align: center;
        }
        #currentPhoto {
            width: 100%; /* 写真のサイズを調整 */
            max-width: 300px;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .player-name {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        h2 {
            font-size: 16px; /* フォントサイズを小さく変更 */
            color: #555;
            margin-bottom: 20px;
        }
        .input-field {
            margin: 10px 0;
            padding: 10px;
            width: calc(100% - 22px); /* Adjust for padding */
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .photo-btn, .submit-btn {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .photo-btn {
            background-color: #f44336;
            color: white;
        }
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            width: 100%;
            display: block;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="image-container">
            <div class="player-name" id="playerName">選手の名前</div>
            <img id="currentPhoto" src="{{ url_for('static', filename='YutoSuzuki.jpg') }}" alt="選手の写真">
            <h2>順位を入力してください</h2>
        </div>

        <!-- POSTメソッドを使用するフォーム -->
        <form id="rankingForm" action="/" method="POST">
            <div class="ranking-container">
                <label for="rank1">1位:</label>
                <input type="number" id="rank1" name="rank[]" class="input-field" required>
                
                <label for="rank2">2位:</label>
                <input type="number" id="rank2" name="rank[]" class="input-field" required>
                
                <label for="rank3">3位:</label>
                <input type="number" id="rank3" name="rank[]" class="input-field" required>
                
                <label for="rank4">4位:</label>
                <input type="number" id="rank4" name="rank[]" class="input-field" required>
                
                <label for="rank5">5位:</label>
                <input type="number" id="rank5" name="rank[]" class="input-field" required>
            </div>

            <!-- 戻る・進むボタン -->
            <button type="button" class="photo-btn" onclick="changePhoto(-1)">戻る</button>
            <button type="button" class="photo-btn" onclick="changePhoto(1)">進む</button>

            <!-- 決定ボタン -->
            <button type="submit" class="submit-btn">決定</button>
        </form>
    </div>

    <script>
        const photos = [
            { src: '{{ url_for("static", filename="YutoSuzuki.jpg") }}' },
            { src: '{{ url_for("static", filename="TaisukeKobayashi.jpg") }}' },
            { src: '{{ url_for("static", filename="HirotoMori.jpg") }}' },
            { src: '{{ url_for("static", filename="RyuheiYamamoto.jpg") }}' },
            { src: '{{ url_for("static", filename="KeisukeKomaki.jpg") }}' }
        ];

        photos.forEach(photo => {
            const fileNameWithoutExtension = photo.src.split('.')[0];
            const formattedName = fileNameWithoutExtension.replace(/([a-z])([A-Z])/g, '$1 $2');
            photo.name = formattedName;
        });

        let currentPhotoIndex = 0;

        function changePhoto(direction) {
            currentPhotoIndex += direction;
            if (currentPhotoIndex < 0) {
                currentPhotoIndex = photos.length - 1; // 最後の写真に戻る
            } else if (currentPhotoIndex >= photos.length) {
                currentPhotoIndex = 0; // 最初の写真に戻る
            }
            document.getElementById('currentPhoto').src = photos[currentPhotoIndex].src;
            document.getElementById('playerName').textContent = photos[currentPhotoIndex].name; // 選手の名前を更新
        }

        // フォームの送信イベントをリッスン
    document.getElementById('rankingForm').addEventListener('submit', async (event) => {
        event.preventDefault(); // デフォルトのフォーム送信を防ぐ

        const formData = new FormData(event.target);
        const rankList = formData.getAll('rank[]').map(Number); // 入力された順位のリストを取得

        // POSTリクエストを送信
        const response = await fetch(event.target.action, {
            method: 'POST',
            body: JSON.stringify(rankList),
            headers: {
                'Content-Type': 'application/json'
            }
        });

        // サーバーから返されたインデックスを取得
        const selectedIndex = await response.json();
        console.log(selectedIndex);
        const match_number = selectedIndex.match;
        
        console.log(match_number); // デバッグ用: 返ってきたインデックスを表示
   
        if (match_number >= 0 && match_number < photos.length) {
            // 返ってきたインデックスに基づいて写真を表示
            document.getElementById('currentPhoto').src = photos[match_number-1].src;
            document.getElementById('playerName').textContent = photos[match_number-1].name;
        }
    });
    </script>
</body>
</html>